<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PHÖNIX – Massnahmen</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bs-stepper/dist/css/bs-stepper.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/custom.css" />
</head>

<body class="bg-light p-4 p-lg-5">

  <!-- CARD 1: Heading + Info + Button -->
  <div class="card border-0 shadow mb-3">
    <div class="card-body p-4">
      <div class="d-flex flex-wrap justify-content-between align-items-start gap-3">
        <div class="flex-grow-1">
          <div class="d-flex align-items-center gap-2">
            <h2 class="fw-normal mb-0">Massnahmen</h2>
            <button class="btn btn-sm p-0 text-muted"
                    data-bs-toggle="collapse"
                    data-bs-target="#hilfeMassnahmen"
                    aria-expanded="false"
                    aria-controls="hilfeMassnahmen"
                    type="button">
              <i class="bi bi-info-circle"></i>
            </button>
          </div>
        </div>

        <div class="d-flex align-items-center gap-2">
          <button class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#massnahmeModal">
            <i class="bi bi-plus-lg me-1"></i> Neue Maßnahme
          </button>
        </div>
      </div>

      <div class="collapse mt-3" id="hilfeMassnahmen">
        <div class="bg-body-tertiary rounded p-3 text-muted small">
          Übersicht aller laufenden und abgeschlossenen Maßnahmen.
          Wählen Sie eine Maßnahme aus, um Teilnehmer zu verwalten, Dokumentationen zu erfassen sowie organisatorische
          und verlaufsbezogene Daten einzusehen.
        </div>
      </div>
    </div>
  </div>

  <!-- CARD 2: Suche + Filter -->
  <div class="card border-0 shadow mb-3">
    <div class="card-body p-3 p-lg-4">
      <div class="row g-2 align-items-end">
        <div class="col-lg-6">
          <label class="form-label text-secondary small mb-1">Suchen</label>
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Maßnahme suchen …" aria-label="Maßnahme suchen" />
            <button class="btn btn-outline-secondary" type="button" aria-label="Suchen">
              <i class="bi bi-search"></i>
            </button>
          </div>
        </div>

        <div class="col-lg-3">
          <label class="form-label text-secondary small mb-1">Jahr</label>
          <select class="form-select" aria-label="Filter nach Jahr">
            <option selected>Alle Jahre</option>
            <option>2026</option>
            <option>2025</option>
            <option>2024</option>
            <option>2023</option>
          </select>
        </div>

        <div class="col-lg-3">
          <label class="form-label text-secondary small mb-1">Typ</label>
          <select class="form-select" aria-label="Filter nach Typ">
            <option selected>Alle Typen</option>
            <option>Aktivierung</option>
            <option>AGH</option>
            <option>Berufsvorbereitung</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- CARD: Laufende Maßnahmen -->
  <div class="card border-0 shadow mb-3">
    <div class="card-body p-0">
      <div class="p-3 p-lg-4 border-bottom d-flex justify-content-between align-items-center">
        <div>
          <div class="text-secondary small">Aktuell</div>
          <h6 class="mb-0">Laufende Maßnahmen</h6>
        </div>
        <span class="badge text-bg-light border" id="massnahmenCountBadge">
          <i class="bi bi-collection me-1"></i> <span id="massnahmenCount">2</span>
        </span>
      </div>

      <div class="list-group list-group-flush" id="massnahmenList">
        <a href="#" class="list-group-item list-group-item-action massnahme-link" data-page="massnahme-detail.html">
          <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
            <div>
              <div class="fw-semibold">Integra 2025</div>
              <small class="text-secondary">01.01.2024 bis 31.06.2025</small>
            </div>
            <div class="d-flex align-items-center gap-4 flex-wrap">
              <div class="text-end">
                <div class="text-secondary small">Typ</div>
                <div>Aktivierung</div>
              </div>
              <div class="text-end">
                <div class="text-secondary small">Förderung</div>
                <div>ESF +</div>
              </div>
              <button class="btn btn-outline-secondary btn-sm" onclick="event.stopPropagation();">
                <i class="bi bi-gear me-1"></i> Verwalten
              </button>
            </div>
          </div>
        </a>

        <a href="#" class="list-group-item list-group-item-action">
          <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
            <div>
              <div class="fw-semibold">Maßnahme 2</div>
              <small class="text-secondary">01.01.2024 bis 31.06.2025</small>
            </div>
            <div class="d-flex align-items-center gap-4 flex-wrap">
              <div class="text-end">
                <div class="text-secondary small">Typ</div>
                <div>Aktivierung</div>
              </div>
              <div class="text-end">
                <div class="text-secondary small">Förderung</div>
                <div>ESF +</div>
              </div>
              <button class="btn btn-outline-secondary btn-sm" onclick="event.stopPropagation();">
                <i class="bi bi-gear me-1"></i> Verwalten
              </button>
            </div>
          </div>
        </a>
      </div>
    </div>
  </div>

  <!-- CARD: Abgeschlossene Maßnahmen -->
  <div class="card border-0 shadow">
    <div class="card-body p-0">
      <div class="p-3 p-lg-4 border-bottom d-flex justify-content-between align-items-center">
        <div>
          <div class="text-secondary small">Archiv</div>
          <h6 class="mb-0">Abgeschlossene Maßnahmen</h6>
        </div>
        <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="collapse" data-bs-target="#abgeschlosseneMassnahmen" type="button">
          <i class="bi bi-chevron-down me-1"></i> Anzeigen
        </button>
      </div>

      <div class="collapse" id="abgeschlosseneMassnahmen">
        <div class="list-group list-group-flush">
          <a href="#" class="list-group-item list-group-item-action">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
              <div>
                <div class="fw-semibold">Integra 2024</div>
                <small class="text-secondary">01.01.2024 bis 31.06.2025</small>
              </div>
              <div class="d-flex align-items-center gap-4 flex-wrap">
                <div class="text-end">
                  <div class="text-secondary small">Typ</div>
                  <div>AGH</div>
                </div>
                <div class="text-end">
                  <div class="text-secondary small">Förderung</div>
                  <div>ESF +</div>
                </div>
                <button class="btn btn-outline-secondary btn-sm" onclick="event.stopPropagation();">
                  <i class="bi bi-gear me-1"></i> Verwalten
                </button>
              </div>
            </div>
          </a>
        </div>
      </div>

    </div>
  </div>

  <!-- MODAL: Neue Maßnahme (Stepper) -->
  <div class="modal fade" id="massnahmeModal" tabindex="-1" aria-labelledby="massnahmeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title" id="massnahmeModalLabel">Neue Maßnahme</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Schließen"></button>
        </div>

        <div class="modal-body">
          <div class="container mt-3">

            <form id="massnahmeForm">
              <div class="card border-0 shadow-sm">
                <div id="massnahmeStepper" class="bs-stepper">

                  <div class="bs-stepper-header m-3" role="tablist">
                    <div class="step" data-target="#m-step-1">
                      <button type="button" class="step-trigger" role="tab" aria-controls="m-step-1" id="m-step-1-trigger">
                        <span class="bs-stepper-circle">1</span>
                        <span>Grunddaten</span>
                      </button>
                    </div>
                    <div class="line"></div>

                    <div class="step" data-target="#m-step-2">
                      <button type="button" class="step-trigger" role="tab" aria-controls="m-step-2" id="m-step-2-trigger">
                        <span class="bs-stepper-circle">2</span>
                        <span>Kosten &amp; Plätze</span>
                      </button>
                    </div>
                    <div class="line"></div>

                    <div class="step" data-target="#m-step-3">
                      <button type="button" class="step-trigger" role="tab" aria-controls="m-step-3" id="m-step-3-trigger">
                        <span class="bs-stepper-circle">3</span>
                        <span>Vergabe &amp; Inhalt</span>
                      </button>
                    </div>
                    <div class="line"></div>

                    <div class="step" data-target="#m-step-4">
                      <button type="button" class="step-trigger" role="tab" aria-controls="m-step-4" id="m-step-4-trigger">
                        <span class="bs-stepper-circle">4</span>
                        <span>Übersicht</span>
                      </button>
                    </div>
                  </div>

                  <div class="bs-stepper-content p-3 p-lg-4">

                    <!-- STEP 1 -->
                    <div id="m-step-1" class="content d-none" role="tabpanel" aria-labelledby="m-step-1-trigger">
                      <div class="row g-3">

                        <div class="col-12 col-md-6">
                          <div class="form-floating">
                            <input type="text" class="form-control" id="mKurzname" placeholder="Kurzname" required minlength="2">
                            <label for="mKurzname">Kurzname</label>
                          </div>
                        </div>

                        <div class="col-12 col-md-3">
                          <div class="form-floating">
                            <input type="date" class="form-control" id="mVon" placeholder=" " required>
                            <label for="mVon">Laufzeit von</label>
                          </div>
                        </div>

                        <div class="col-12 col-md-3">
                          <div class="form-floating">
                            <input type="date" class="form-control" id="mBis" placeholder=" " required>
                            <label for="mBis">Laufzeit bis</label>
                          </div>
                        </div>

                        <div class="col-12 col-md-4">
                          <div class="form-floating">
                            <input type="text" class="form-control" id="mNrArge" placeholder="nrArge">
                            <label for="mNrArge">nrArge</label>
                          </div>
                        </div>

                        <div class="col-12 col-md-4">
                          <div class="form-floating">
                            <input type="text" class="form-control" id="mKostenstelle" placeholder="Kostenstelle">
                            <label for="mKostenstelle">Kostenstelle</label>
                          </div>
                        </div>

                        <div class="col-12 col-md-4">
                          <div class="form-floating">
                            <input type="text" class="form-control" id="mAZ" placeholder="AZ">
                            <label for="mAZ">AZ</label>
                          </div>
                        </div>

                        <!-- NEU: Wöchentliche Arbeitszeit -->
                        <div class="col-12 col-md-4">
                          <div class="form-floating">
                            <input type="number" class="form-control" id="mWochenArbeitszeit" placeholder="Wöchentliche Arbeitszeit" min="0" step="0.25">
                            <label for="mWochenArbeitszeit">Wöchentliche Arbeitszeit (Std.)</label>
                          </div>
                        </div>

                        <div class="col-12 col-md-6">
                          <div class="form-floating">
                            <select class="form-select" id="mFoerderung">
                              <option value="" selected>Bitte wählen …</option>
                              <option>ESF</option>
                              <option>Andere</option>
                            </select>
                            <label for="mFoerderung">Förderung</label>
                          </div>
                        </div>

                        <div class="col-12 col-md-6">
                          <div class="form-floating">
                            <select class="form-select" id="mKategorie">
                              <option value="" selected>Bitte wählen …</option>
                              <option>Sonstige</option>
                              <option>AGH</option>
                              <option>Aktivierung</option>
                            </select>
                            <label for="mKategorie">Kategorie</label>
                          </div>
                        </div>

                        <div class="col-12">
                          <div class="form-floating">
                            <input type="text" class="form-control" id="mSonstiges" placeholder="Sonstiges">
                            <label for="mSonstiges">Sonstiges</label>
                          </div>
                        </div>

                        <!-- Ansprechpartner -->
                        <div class="col-12">
                          <div class="border rounded-3 p-3 bg-white">
                            <div class="fw-semibold">Ansprechpartner</div>
                            <div class="text-muted small mb-2">Namen hinzufügen (Demo).</div>

                            <div class="row g-2 align-items-end">
                              <div class="col-12 col-md-6">
                                <label class="form-label small text-muted mb-1" for="mKontaktName">Name</label>
                                <input type="text" class="form-control" id="mKontaktName" placeholder="z. B. Frau Müller">
                              </div>
                              <div class="col-12 col-md-6 d-flex gap-2">
                                <button type="button" class="btn btn-outline-primary" id="btnAddKontakt">
                                  <i class="bi bi-plus-lg me-1"></i> Hinzufügen
                                </button>
                                <button type="button" class="btn btn-outline-secondary" id="btnClearKontakte">
                                  <i class="bi bi-x-lg me-1"></i> Leeren
                                </button>
                              </div>
                            </div>

                            <div class="mt-3">
                              <div class="small text-muted mb-1">Liste</div>
                              <div class="list-group small" id="kontakteList"></div>
                            </div>
                          </div>
                        </div>

                      </div>

                      <div class="mt-4 d-flex justify-content-end">
                        <button type="button" class="btn btn-primary" id="btnMNext1">
                          Weiter <i class="bi bi-arrow-right ms-1"></i>
                        </button>
                      </div>
                    </div>

                    <!-- STEP 2 -->
                    <div id="m-step-2" class="content d-none" role="tabpanel" aria-labelledby="m-step-2-trigger">
                      <div class="row g-3">

                        <div class="col-12 col-md-4">
                          <div class="form-floating">
                            <input type="number" class="form-control" id="mPlatzzahl" placeholder="Platzzahl" min="0" step="1">
                            <label for="mPlatzzahl">Platzzahl</label>
                          </div>
                        </div>

                        <div class="col-12 col-md-4">
                          <div class="form-floating">
                            <input type="number" class="form-control" id="mKostenpauschale" placeholder="Kostenpauschale" min="0" step="0.01">
                            <label for="mKostenpauschale">Kostenpauschale (€)</label>
                          </div>
                        </div>

                        <div class="col-12 col-md-4">
                          <div class="form-floating">
                            <input type="number" class="form-control" id="mMehraufwand" placeholder="Mehraufwand" min="0" step="0.01">
                            <label for="mMehraufwand">Mehraufwand (€)</label>
                          </div>
                        </div>

                        <div class="col-12 col-md-4">
                          <div class="form-floating">
                            <input type="number" class="form-control" id="mUrlaub" placeholder="Anzahl U (Urlaub)" min="0" step="1">
                            <label for="mUrlaub">Anzahl U (Urlaub)</label>
                          </div>
                        </div>

                      </div>

                      <div class="mt-4 d-flex justify-content-between">
                        <button type="button" class="btn btn-outline-secondary" id="btnMBack2">
                          <i class="bi bi-arrow-left me-1"></i> Zurück
                        </button>
                        <button type="button" class="btn btn-primary" id="btnMNext2">
                          Weiter <i class="bi bi-arrow-right ms-1"></i>
                        </button>
                      </div>
                    </div>

                    <!-- STEP 3 -->
                    <div id="m-step-3" class="content d-none" role="tabpanel" aria-labelledby="m-step-3-trigger">
                      <div class="row g-3">

                        <div class="col-12 col-md-6">
                          <div class="form-floating">
                            <input type="text" class="form-control" id="mVergabenummer" placeholder="Vergabenummer">
                            <label for="mVergabenummer">Vergabenummer</label>
                          </div>
                        </div>

                        <div class="col-12 col-md-6">
                          <div class="form-floating">
                            <input type="text" class="form-control" id="mLosnummer" placeholder="Losnummer">
                            <label for="mLosnummer">Losnummer</label>
                          </div>
                        </div>

                        <div class="col-12 col-md-6">
                          <div class="form-floating">
                            <input type="text" class="form-control" id="mVBArbeitsverteilung" placeholder="VB Arbeitsverteilung">
                            <label for="mVBArbeitsverteilung">VB Arbeitsverteilung</label>
                          </div>
                        </div>

                        <!-- Tätigkeit größer -->
                        <div class="col-12">
                          <div class="form-floating">
                            <textarea class="form-control" id="mTaetigkeit" placeholder=" " style="height: 160px"></textarea>
                            <label for="mTaetigkeit">Tätigkeit</label>
                          </div>
                        </div>

                      </div>

                      <div class="mt-4 d-flex justify-content-between">
                        <button type="button" class="btn btn-outline-secondary" id="btnMBack3">
                          <i class="bi bi-arrow-left me-1"></i> Zurück
                        </button>
                        <button type="button" class="btn btn-primary" id="btnMNext3">
                          Weiter <i class="bi bi-arrow-right ms-1"></i>
                        </button>
                      </div>
                    </div>

                    <!-- STEP 4 -->
                    <div id="m-step-4" class="content d-none" role="tabpanel" aria-labelledby="m-step-4-trigger">

                      <div class="border rounded-3 p-3 bg-white">
                        <div class="fw-semibold mb-2">Übersicht Eingaben</div>
                        <div class="small" id="massnahmeSummary"></div>
                      </div>

                      <div class="alert alert-light border small mt-3 mb-0">
                        Nach dem Speichern erscheint die Maßnahme (Demo) in der Liste.
                      </div>

                      <div class="mt-4 d-flex justify-content-between align-items-center flex-wrap gap-2">
                        <button type="button" class="btn btn-outline-secondary" id="btnMBack4">
                          <i class="bi bi-arrow-left me-1"></i> Zurück
                        </button>

                        <div class="d-flex gap-2">
                          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                            Abbrechen
                          </button>
                          <button type="submit" class="btn btn-success">
                            <i class="bi bi-save me-1"></i> Maßnahme speichern
                          </button>
                        </div>
                      </div>

                    </div>

                  </div><!-- /content -->
                </div><!-- /stepper -->
              </div><!-- /card -->
            </form>

          </div>
        </div>

      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bs-stepper/dist/js/bs-stepper.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll(".massnahme-link").forEach(link => {
        link.style.cursor = "pointer";
        link.addEventListener("click", function (e) {
          e.preventDefault();
          const targetPage = this.getAttribute("data-page");
          let frame = null;
          try { frame = parent.document.getElementById("mainFrame"); } catch (err) {}
          if (frame && targetPage) frame.src = targetPage;
          else if (targetPage) window.location.href = targetPage;
        });
      });
    });
  </script>

  <script>
    let mStepper;
    const kontakte = [];

    function showMStep(id) {
      document.querySelectorAll("#massnahmeStepper .bs-stepper-content .content")
        .forEach(s => s.classList.add("d-none"));
      const active = document.getElementById(id);
      if (active) active.classList.remove("d-none");
    }

    function esc(s) {
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function fmtDateDE(iso) {
      if (!iso) return "–";
      const [y,m,d] = iso.split("-");
      if (!y || !m || !d) return iso;
      return `${d}.${m}.${y}`;
    }

    function euro(v) {
      if (v === "" || v == null) return "–";
      const n = Number(v);
      if (Number.isNaN(n)) return "–";
      return n.toLocaleString("de-DE", { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " €";
    }

    function renderKontakteList() {
      const list = document.getElementById("kontakteList");
      if (!list) return;

      if (kontakte.length === 0) {
        list.innerHTML = `<div class="text-muted small">Noch keine Ansprechpartner hinzugefügt.</div>`;
        return;
      }

      list.innerHTML = kontakte.map((k, idx) => `
        <div class="list-group-item d-flex justify-content-between align-items-center">
          <span>${esc(k)}</span>
          <button type="button" class="btn btn-outline-danger btn-sm" data-del="${idx}">
            <i class="bi bi-trash"></i>
          </button>
        </div>
      `).join("");

      list.querySelectorAll("[data-del]").forEach(btn => {
        btn.addEventListener("click", () => {
          const i = Number(btn.getAttribute("data-del"));
          kontakte.splice(i, 1);
          renderKontakteList();
        });
      });
    }

    function buildSummary() {
      const sEl = document.getElementById("massnahmeSummary");

      const data = {
        Kurzname: document.getElementById("mKurzname").value.trim(),
        "Laufzeit von": fmtDateDE(document.getElementById("mVon").value),
        "Laufzeit bis": fmtDateDE(document.getElementById("mBis").value),
        nrArge: document.getElementById("mNrArge").value.trim(),
        Kostenstelle: document.getElementById("mKostenstelle").value.trim(),
        AZ: document.getElementById("mAZ").value.trim(),
        "Wöchentliche Arbeitszeit": document.getElementById("mWochenArbeitszeit").value ? (document.getElementById("mWochenArbeitszeit").value + " Std.") : "–",
        Förderung: document.getElementById("mFoerderung").value || "–",
        Kategorie: document.getElementById("mKategorie").value || "–",
        Sonstiges: document.getElementById("mSonstiges").value.trim(),
        Platzzahl: document.getElementById("mPlatzzahl").value,
        "Kostenpauschale": euro(document.getElementById("mKostenpauschale").value),
        "Mehraufwand": euro(document.getElementById("mMehraufwand").value),
        "Anzahl U (Urlaub)": document.getElementById("mUrlaub").value,
        Vergabenummer: document.getElementById("mVergabenummer").value.trim(),
        Losnummer: document.getElementById("mLosnummer").value.trim(),
        "VB Arbeitsverteilung": document.getElementById("mVBArbeitsverteilung").value.trim(),
        Tätigkeit: document.getElementById("mTaetigkeit").value.trim(),
        Ansprechpartner: kontakte.length ? kontakte.join(", ") : "–"
      };

      if (sEl) {
        sEl.innerHTML = `
          <dl class="row mb-0">
            ${Object.entries(data).map(([k,v]) => `
              <dt class="col-5 text-muted">${esc(k)}</dt>
              <dd class="col-7 mb-2">${esc(v || "–")}</dd>
            `).join("")}
          </dl>
        `;
      }
    }

    function appendMassnahmeToList(payload) {
      const list = document.getElementById("massnahmenList");
      const count = document.getElementById("massnahmenCount");
      if (!list) return;

      const von = fmtDateDE(payload.von);
      const bis = fmtDateDE(payload.bis);

      const item = document.createElement("a");
      item.href = "#";
      item.className = "list-group-item list-group-item-action";
      item.innerHTML = `
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
          <div>
            <div class="fw-semibold">${esc(payload.kurzname || "Neue Maßnahme")}</div>
            <small class="text-secondary">${esc(von)} bis ${esc(bis)}</small>
          </div>
          <div class="d-flex align-items-center gap-4 flex-wrap">
            <div class="text-end">
              <div class="text-secondary small">Kategorie</div>
              <div>${esc(payload.kategorie || "—")}</div>
            </div>
            <div class="text-end">
              <div class="text-secondary small">Förderung</div>
              <div>${esc(payload.foerderung || "—")}</div>
            </div>
            <button class="btn btn-outline-secondary btn-sm" onclick="event.stopPropagation();">
              <i class="bi bi-gear me-1"></i> Verwalten
            </button>
          </div>
        </div>
      `;
      list.prepend(item);

      if (count) {
        const n = Number(count.textContent || "0");
        count.textContent = String(n + 1);
      }
    }

    document.addEventListener("DOMContentLoaded", function () {
      const stepperEl = document.getElementById("massnahmeStepper");
      if (stepperEl) {
        mStepper = new window.Stepper(stepperEl);
        showMStep("m-step-1");
      }

      const btnAdd = document.getElementById("btnAddKontakt");
      const btnClear = document.getElementById("btnClearKontakte");
      const nameEl = document.getElementById("mKontaktName");

      if (btnAdd && nameEl) {
        btnAdd.addEventListener("click", () => {
          const name = nameEl.value.trim();
          if (!name) return;
          kontakte.push(name);
          nameEl.value = "";
          renderKontakteList();
        });
      }
      if (btnClear) {
        btnClear.addEventListener("click", () => {
          kontakte.length = 0;
          renderKontakteList();
        });
      }
      renderKontakteList();

      const btnMNext1 = document.getElementById("btnMNext1");
      const btnMNext2 = document.getElementById("btnMNext2");
      const btnMNext3 = document.getElementById("btnMNext3");
      const btnMBack2 = document.getElementById("btnMBack2");
      const btnMBack3 = document.getElementById("btnMBack3");
      const btnMBack4 = document.getElementById("btnMBack4");

      if (btnMNext1) btnMNext1.addEventListener("click", () => {
        const kurz = document.getElementById("mKurzname");
        const von  = document.getElementById("mVon");
        const bis  = document.getElementById("mBis");
        if (!kurz.value.trim() || !von.value || !bis.value) {
          alert("Bitte Kurzname sowie Laufzeit von/bis ausfüllen.");
          return;
        }
        mStepper.next(); showMStep("m-step-2");
      });

      if (btnMBack2) btnMBack2.addEventListener("click", () => { mStepper.previous(); showMStep("m-step-1"); });
      if (btnMNext2) btnMNext2.addEventListener("click", () => { mStepper.next(); showMStep("m-step-3"); });

      if (btnMBack3) btnMBack3.addEventListener("click", () => { mStepper.previous(); showMStep("m-step-2"); });
      if (btnMNext3) btnMNext3.addEventListener("click", () => {
        buildSummary();
        mStepper.next(); showMStep("m-step-4");
      });

      if (btnMBack4) btnMBack4.addEventListener("click", () => { mStepper.previous(); showMStep("m-step-3"); });

      const modalEl = document.getElementById("massnahmeModal");
      if (modalEl) {
        modalEl.addEventListener("hidden.bs.modal", () => {
          document.getElementById("massnahmeForm")?.reset();
          kontakte.length = 0;
          renderKontakteList();
          if (mStepper) mStepper.to(1);
          showMStep("m-step-1");
        });
      }

      const form = document.getElementById("massnahmeForm");
      if (form) {
        form.addEventListener("submit", (e) => {
          e.preventDefault();

          const payload = {
            kurzname: document.getElementById("mKurzname").value.trim(),
            von: document.getElementById("mVon").value,
            bis: document.getElementById("mBis").value,
            kategorie: document.getElementById("mKategorie").value,
            foerderung: document.getElementById("mFoerderung").value,
            wochenarbeitszeit: document.getElementById("mWochenArbeitszeit").value,
            ansprechpartner: [...kontakte]
          };

          appendMassnahmeToList(payload);
          alert("Maßnahme gespeichert! (Demo)");
          bootstrap.Modal.getInstance(modalEl)?.hide();
        });
      }
    });
  </script>

</body>
</html>
