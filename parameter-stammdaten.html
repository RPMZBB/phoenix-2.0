<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Parameter – Stammdaten</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
</head>

<body class="p-4 bg-light">

<div class="container-fluid">

  <!-- Header -->
  <div class="card border-0 shadow mb-4">
    <div class="card-body p-4">
      <div class="d-flex justify-content-between align-items-start gap-3">
        <div>
          <h2 class="fw-normal mb-1">
            <i class="bi bi-database me-2"></i>
            Stammdaten
          </h2>
          <div class="text-muted" style="font-size: 0.95rem;">
            Verwaltung zentraler Stammdaten für <strong>Standorte</strong>, <strong>eigene Firma</strong>, <strong>Banken</strong>,
            <strong>Personal</strong> und <strong>ÖPNV-Tarife</strong>.
          </div>

          <!-- Info aufklappbar -->
          <div class="mt-2">
            <button class="btn btn-sm btn-outline-secondary"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#stammInfo"
                    aria-expanded="false"
                    aria-controls="stammInfo">
              <i class="bi bi-info-circle me-1"></i> Info
            </button>

            <div class="collapse mt-2" id="stammInfo">
              <div class="p-3 bg-white border rounded">
                <div class="text-muted" style="font-size:.95rem;">
                  Diese Bereiche werden typischerweise für <strong>Briefköpfe</strong>, <strong>Berichte</strong>, <strong>Auswertungen</strong>
                  und <strong>Dropdown-Auswahl</strong> in anderen Masken genutzt.
                  <div class="mt-2 small text-muted">
                    Demo: Speicherung nur im Browser (LocalStorage).
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>

        <span class="badge bg-secondary-subtle text-secondary border align-self-start">
          <i class="bi bi-gear me-1"></i> Administrationsbereich
        </span>
      </div>
    </div>
  </div>

  <!-- Accordion -->
  <div class="accordion" id="stammAccordion">

    <!-- EIGENE FIRMA -->
    <div class="accordion-item border-0 mb-3 shadow-sm">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed bg-white text-dark fw-semibold"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#firmaBlock">
          <i class="bi bi-building-check me-2"></i> Eigene Firma (Bildungsträger)
        </button>
      </h2>

      <div id="firmaBlock" class="accordion-collapse collapse" data-bs-parent="#stammAccordion">
        <div class="accordion-body bg-light">

          <form id="firmaForm" class="mb-4">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input class="form-control" id="firmaName" placeholder="Firmenname" required>
                  <label for="firmaName">Firmenname</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input class="form-control" id="firmaZusatz" placeholder="Zusatz">
                  <label for="firmaZusatz">Firmenname-Zusatz (optional)</label>
                </div>
              </div>

              <div class="col-md-8">
                <div class="form-floating">
                  <input class="form-control" id="firmaStrasse" placeholder="Straße">
                  <label for="firmaStrasse">Straße / Hausnummer</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input class="form-control" id="firmaPlzOrt" placeholder="PLZ / Ort">
                  <label for="firmaPlzOrt">PLZ / Ort</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input class="form-control" id="firmaTelefon" placeholder="Telefon">
                  <label for="firmaTelefon">Telefon</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input type="email" class="form-control" id="firmaMail" placeholder="E-Mail">
                  <label for="firmaMail">E-Mail</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input class="form-control" id="firmaWeb" placeholder="Webseite">
                  <label for="firmaWeb">Webseite</label>
                </div>
              </div>

              <div class="col-12">
                <div class="form-floating">
                  <textarea class="form-control" id="firmaSonstiges" style="height: 110px" placeholder="Sonstiges"></textarea>
                  <label for="firmaSonstiges">Sonstige Angaben (HRB, Steuernummer, …)</label>
                </div>
              </div>
            </div>

            <div class="text-end mt-3">
              <button class="btn btn-primary btn-sm" type="submit">
                <i class="bi bi-save me-1"></i> Stammdaten speichern
              </button>
            </div>
          </form>

          <div class="bg-white border rounded p-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="fw-semibold">Gespeicherte Firmenprofile</div>
              <span class="text-muted small">Bearbeiten / Löschen</span>
            </div>
            <ul class="list-group list-group-sm" id="firmaList"></ul>
          </div>

        </div>
      </div>
    </div>

    <!-- STANDORTE -->
    <div class="accordion-item border-0 mb-3 shadow-sm">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed bg-white text-dark fw-semibold"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#standortBlock">
          <i class="bi bi-geo-alt me-2"></i> Standorte
        </button>
      </h2>

      <div id="standortBlock" class="accordion-collapse collapse" data-bs-parent="#stammAccordion">
        <div class="accordion-body bg-light">

          <form id="standortForm" class="mb-4">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input class="form-control" id="standortName" placeholder="Standortname" required>
                  <label for="standortName">Standortname</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input class="form-control" id="standortKuerzel" placeholder="Kürzel">
                  <label for="standortKuerzel">Kürzel (optional)</label>
                </div>
              </div>

              <div class="col-md-8">
                <div class="form-floating">
                  <input class="form-control" id="standortStrasse" placeholder="Straße">
                  <label for="standortStrasse">Straße / Hausnummer</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input class="form-control" id="standortPlzOrt" placeholder="PLZ / Ort">
                  <label for="standortPlzOrt">PLZ / Ort</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input class="form-control" id="standortTelefon" placeholder="Telefon">
                  <label for="standortTelefon">Telefon</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input type="email" class="form-control" id="standortMail" placeholder="E-Mail">
                  <label for="standortMail">E-Mail</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input class="form-control" id="standortLeitung" placeholder="Ansprechpartner">
                  <label for="standortLeitung">Leitung / Ansprechpartner</label>
                </div>
              </div>
            </div>

            <div class="text-end mt-3">
              <button class="btn btn-primary btn-sm" type="submit">
                <i class="bi bi-save me-1"></i> Standort speichern
              </button>
            </div>
          </form>

          <div class="bg-white border rounded p-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="fw-semibold">Vorhandene Standorte</div>
              <span class="text-muted small">Bearbeiten / Löschen</span>
            </div>
            <ul class="list-group list-group-sm" id="standortList"></ul>
          </div>

        </div>
      </div>
    </div>

    <!-- BANKEN -->
    <div class="accordion-item border-0 mb-3 shadow-sm">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed bg-white text-dark fw-semibold"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#bankenBlock">
          <i class="bi bi-bank me-2"></i> Banken
        </button>
      </h2>

      <div id="bankenBlock" class="accordion-collapse collapse" data-bs-parent="#stammAccordion">
        <div class="accordion-body bg-light">

          <form id="bankForm" class="mb-4">
            <div class="row g-3">
              <div class="col-md-7">
                <div class="form-floating">
                  <input class="form-control" id="bankName" placeholder="Bankname" required>
                  <label for="bankName">Bankname</label>
                </div>
              </div>
              <div class="col-md-5">
                <div class="form-floating">
                  <input class="form-control" id="bankBlz" placeholder="BLZ / BIC" required>
                  <label for="bankBlz">Bankleitzahl / BIC</label>
                </div>
              </div>
            </div>

            <div class="text-end mt-3">
              <button class="btn btn-primary btn-sm" type="submit">
                <i class="bi bi-save me-1"></i> Bank speichern
              </button>
            </div>
          </form>

          <div class="bg-white border rounded p-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="fw-semibold">Vorhandene Banken</div>
              <span class="text-muted small">Bearbeiten / Löschen</span>
            </div>
            <ul class="list-group list-group-sm" id="bankList"></ul>
          </div>

        </div>
      </div>
    </div>

    <!-- PERSONAL -->
    <div class="accordion-item border-0 mb-3 shadow-sm">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed bg-white text-dark fw-semibold"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#personalBlock">
          <i class="bi bi-person-badge me-2"></i> Personal (Bildungsträger)
        </button>
      </h2>

      <div id="personalBlock" class="accordion-collapse collapse" data-bs-parent="#stammAccordion">
        <div class="accordion-body bg-light">

          <form id="personalForm" class="mb-4">
            <div class="row g-3">
              <div class="col-md-4">
                <div class="form-floating">
                  <input class="form-control" id="persVorname" placeholder="Vorname" required>
                  <label for="persVorname">Vorname</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input class="form-control" id="persNachname" placeholder="Nachname" required>
                  <label for="persNachname">Nachname</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input class="form-control" id="persFunktion" placeholder="Funktion">
                  <label for="persFunktion">Funktion (optional)</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input class="form-control" id="persTelefon" placeholder="Telefon">
                  <label for="persTelefon">Telefon</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input type="email" class="form-control" id="persMail" placeholder="E-Mail">
                  <label for="persMail">E-Mail</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input class="form-control" id="persStandort" placeholder="Standort">
                  <label for="persStandort">Standort (z. B. SB)</label>
                </div>
              </div>
            </div>

            <div class="text-end mt-3">
              <button class="btn btn-primary btn-sm" type="submit">
                <i class="bi bi-save me-1"></i> Mitarbeiter speichern
              </button>
            </div>
          </form>

          <div class="bg-white border rounded p-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="fw-semibold">Vorhandenes Personal</div>
              <span class="text-muted small">Bearbeiten / Löschen</span>
            </div>
            <ul class="list-group list-group-sm" id="personalList"></ul>
          </div>

        </div>
      </div>
    </div>

    <!-- ÖPNV -->
    <div class="accordion-item border-0 mb-3 shadow-sm">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed bg-white text-dark fw-semibold"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#oepnvBlock">
          <i class="bi bi-train-front me-2"></i> ÖPNV-Tarife
        </button>
      </h2>

      <div id="oepnvBlock" class="accordion-collapse collapse" data-bs-parent="#stammAccordion">
        <div class="accordion-body bg-light">

          <form id="tarifForm" class="mb-4">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input class="form-control" id="tarifName" placeholder="Tarifname" required>
                  <label for="tarifName">Tarifname</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input class="form-control" id="tarifArt" placeholder="Ticketart">
                  <label for="tarifArt">Ticketart (optional)</label>
                </div>
              </div>

              <div class="col-md-2">
                <div class="form-floating">
                  <input type="number" step="0.01" class="form-control" id="tarifPreis" placeholder="Preis" required>
                  <label for="tarifPreis">Preis (€)</label>
                </div>
              </div>
            </div>

            <div class="text-end mt-3">
              <button class="btn btn-primary btn-sm" type="submit">
                <i class="bi bi-save me-1"></i> Tarif speichern
              </button>
            </div>
          </form>

          <div class="bg-white border rounded p-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="fw-semibold">Vorhandene ÖPNV-Tarife</div>
              <span class="text-muted small">Bearbeiten / Löschen</span>
            </div>
            <ul class="list-group list-group-sm" id="tarifList"></ul>
          </div>

        </div>
      </div>
    </div>

  </div><!-- /accordion -->

</div><!-- /container -->

<!-- Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Demo-Logik: LocalStorage + Bearbeiten -->
<script>
function escHtml(str) {
  return String(str ?? "")
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;")
    .replaceAll("'", "&#039;");
}

function setupEditableList({
  formId,
  fields,          // [{id, label}]
  listId,
  storageKey,
  formatPreview    // (obj) => string
}) {
  const form = document.getElementById(formId);
  const list = document.getElementById(listId);

  function load() {
    return JSON.parse(localStorage.getItem(storageKey) || "[]");
  }
  function save(data) {
    localStorage.setItem(storageKey, JSON.stringify(data));
  }

  function render() {
    const data = load();
    list.innerHTML = "";

    if (data.length === 0) {
      const empty = document.createElement("div");
      empty.className = "text-muted small";
      empty.textContent = "Noch keine Einträge vorhanden.";
      list.appendChild(empty);
      return;
    }

    data.forEach((item, idx) => {
      const li = document.createElement("li");
      li.className = "list-group-item";

      const preview = formatPreview(item);

      li.innerHTML = `
        <div class="d-flex justify-content-between align-items-start gap-3">
          <div class="flex-grow-1">
            <div class="fw-semibold">${escHtml(preview)}</div>
          </div>

          <div class="btn-group btn-group-sm flex-shrink-0">
            <button class="btn btn-outline-secondary" data-action="edit">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-outline-danger" data-action="delete">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </div>

        <div class="mt-3 d-none" data-edit-panel>
          <div class="row g-2">
            ${fields.map(f => `
              <div class="col-md-6">
                <div class="form-floating">
                  <input class="form-control" placeholder="${escHtml(f.label)}" data-field="${escHtml(f.id)}" value="${escHtml(item[f.id] || "")}">
                  <label>${escHtml(f.label)}</label>
                </div>
              </div>
            `).join("")}
          </div>

          <div class="d-flex justify-content-end gap-2 mt-2">
            <button class="btn btn-outline-secondary btn-sm" data-action="cancel">
              Abbrechen
            </button>
            <button class="btn btn-primary btn-sm" data-action="save">
              <i class="bi bi-save me-1"></i> Speichern
            </button>
          </div>
        </div>
      `;

      li.querySelector('[data-action="delete"]').addEventListener("click", () => {
        const next = load().filter((_, i) => i !== idx);
        save(next);
        render();
      });

      li.querySelector('[data-action="edit"]').addEventListener("click", () => {
        li.querySelector("[data-edit-panel]").classList.toggle("d-none");
      });

      li.querySelector('[data-action="cancel"]').addEventListener("click", () => {
        li.querySelector("[data-edit-panel]").classList.add("d-none");
        render();
      });

      li.querySelector('[data-action="save"]').addEventListener("click", () => {
        const next = load();
        const panel = li.querySelector("[data-edit-panel]");
        const updated = { ...next[idx] };

        panel.querySelectorAll("[data-field]").forEach(inp => {
          const key = inp.getAttribute("data-field");
          updated[key] = inp.value.trim();
        });

        const firstKey = fields[0].id;
        if (!updated[firstKey]) return;

        next[idx] = updated;
        save(next);
        render();
      });

      list.appendChild(li);
    });
  }

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const obj = {};
    fields.forEach(f => {
      obj[f.id] = (document.getElementById(f.id).value || "").trim();
    });

    if (!obj[fields[0].id]) return;

    const data = load();
    data.push(obj);
    save(data);
    form.reset();
    render();
  });

  render();
}

/* Eigene Firma */
setupEditableList({
  formId: "firmaForm",
  listId: "firmaList",
  storageKey: "stamm_firma",
  fields: [
    { id: "firmaName", label: "Firmenname" },
    { id: "firmaZusatz", label: "Firmenname-Zusatz (optional)" },
    { id: "firmaStrasse", label: "Straße / Hausnummer" },
    { id: "firmaPlzOrt", label: "PLZ / Ort" },
    { id: "firmaTelefon", label: "Telefon" },
    { id: "firmaMail", label: "E-Mail" },
    { id: "firmaWeb", label: "Webseite" },
    { id: "firmaSonstiges", label: "Sonstige Angaben (HRB, Steuernummer, …)" }
  ],
  formatPreview: (o) => o.firmaZusatz ? `${o.firmaName} (${o.firmaZusatz})` : o.firmaName
});

/* Standorte */
setupEditableList({
  formId: "standortForm",
  listId: "standortList",
  storageKey: "stamm_standorte",
  fields: [
    { id: "standortName", label: "Standortname" },
    { id: "standortKuerzel", label: "Kürzel (optional)" },
    { id: "standortStrasse", label: "Straße / Hausnummer" },
    { id: "standortPlzOrt", label: "PLZ / Ort" },
    { id: "standortTelefon", label: "Telefon" },
    { id: "standortMail", label: "E-Mail" },
    { id: "standortLeitung", label: "Leitung / Ansprechpartner" }
  ],
  formatPreview: (o) => o.standortKuerzel ? `${o.standortName} (${o.standortKuerzel})` : o.standortName
});

/* Banken */
setupEditableList({
  formId: "bankForm",
  listId: "bankList",
  storageKey: "stamm_banken",
  fields: [
    { id: "bankName", label: "Bankname" },
    { id: "bankBlz", label: "Bankleitzahl / BIC" }
  ],
  formatPreview: (o) => `${o.bankName} – ${o.bankBlz}`
});

/* Personal */
setupEditableList({
  formId: "personalForm",
  listId: "personalList",
  storageKey: "stamm_personal",
  fields: [
    { id: "persVorname", label: "Vorname" },
    { id: "persNachname", label: "Nachname" },
    { id: "persFunktion", label: "Funktion (optional)" },
    { id: "persTelefon", label: "Telefon" },
    { id: "persMail", label: "E-Mail" },
    { id: "persStandort", label: "Standort (z. B. SB)" }
  ],
  formatPreview: (o) => {
    const name = `${o.persVorname} ${o.persNachname}`.trim();
    const extra = [o.persFunktion, o.persStandort].filter(Boolean).join(" • ");
    return extra ? `${name} – ${extra}` : name;
  }
});

/* ÖPNV Tarife */
setupEditableList({
  formId: "tarifForm",
  listId: "tarifList",
  storageKey: "stamm_oepnv",
  fields: [
    { id: "tarifName", label: "Tarifname" },
    { id: "tarifArt", label: "Ticketart (optional)" },
    { id: "tarifPreis", label: "Preis (€)" }
  ],
  formatPreview: (o) => {
    const preis = o.tarifPreis ? `${o.tarifPreis} €` : "";
    const extra = [o.tarifArt, preis].filter(Boolean).join(" • ");
    return extra ? `${o.tarifName} – ${extra}` : o.tarifName;
  }
});
</script>

</body>
</html>
