<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Parameter – Organisation</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
</head>

<body class="p-4 bg-light">

<div class="container-fluid">

  <!-- Header -->
  <div class="card border-0 shadow mb-4">
    <div class="card-body p-4">
      <div class="d-flex justify-content-between align-items-start gap-3">
        <div>
          <h2 class="fw-normal mb-1">
            <i class="bi bi-diagram-3 me-2"></i>
            Organisation
          </h2>
          <div class="text-muted" style="font-size: 0.95rem;">
            Verwaltung von <strong>Jobcentern</strong>, <strong>Teams</strong> und <strong>Arbeitsbereichen</strong>
            für Zuordnung, Berichte und Auswertungen.
          </div>

          <!-- Info aufklappbar -->
          <div class="mt-2">
            <button class="btn btn-sm btn-outline-secondary"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#orgInfo"
                    aria-expanded="false"
                    aria-controls="orgInfo">
              <i class="bi bi-info-circle me-1"></i> Info
            </button>

            <div class="collapse mt-2" id="orgInfo">
              <div class="p-3 bg-white border rounded">
                <div class="text-muted" style="font-size:.95rem;">
                  <strong>Jobcenter</strong> dienen der Stammdatenpflege und Ansprechpartner-Zuordnung.<br>
                  <strong>Teams</strong> strukturieren Zuständigkeiten innerhalb eines Jobcenters.<br>
                  <strong>Arbeitsbereiche</strong> werden u. a. in Maßnahmen, Listen und Berichten verwendet.
                  <div class="mt-2 small text-muted">
                    Demo: Einträge werden nur im Browser gespeichert (LocalStorage).
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>

        <span class="badge bg-secondary-subtle text-secondary border align-self-start">
          <i class="bi bi-gear me-1"></i> Administrationsbereich
        </span>
      </div>
    </div>
  </div>

  <!-- Accordion -->
  <div class="accordion" id="orgAccordion">

    <!-- JOBCENTER -->
    <div class="accordion-item border-0 mb-3 shadow-sm">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed bg-white text-dark fw-semibold"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#jobcenterBlock">
          <i class="bi bi-building me-2"></i> Jobcenter
        </button>
      </h2>

      <div id="jobcenterBlock" class="accordion-collapse collapse" data-bs-parent="#orgAccordion">
        <div class="accordion-body bg-light">

          <form id="jobcenterForm" class="mb-4">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input class="form-control" id="jcName" placeholder="Name" required>
                  <label for="jcName">Name des Jobcenters</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input class="form-control" id="jcZusatz" placeholder="Zusatz">
                  <label for="jcZusatz">Firmenname-Zusatz (optional)</label>
                </div>
              </div>
            </div>

            <div class="text-end mt-3">
              <button class="btn btn-primary btn-sm" type="submit">
                <i class="bi bi-save me-1"></i> Jobcenter speichern
              </button>
            </div>
          </form>

          <div class="bg-white border rounded p-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="fw-semibold">Vorhandene Jobcenter</div>
              <span class="text-muted small">Bearbeiten / Löschen</span>
            </div>
            <ul class="list-group list-group-sm" id="jobcenterList"></ul>
          </div>

        </div>
      </div>
    </div>

    <!-- TEAMS -->
    <div class="accordion-item border-0 mb-3 shadow-sm">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed bg-white text-dark fw-semibold"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#teamBlock">
          <i class="bi bi-people me-2"></i> Teams (Jobcenter)
        </button>
      </h2>

      <div id="teamBlock" class="accordion-collapse collapse" data-bs-parent="#orgAccordion">
        <div class="accordion-body bg-light">

          <form id="teamForm" class="mb-4">
            <div class="form-floating mb-3">
              <input class="form-control" id="teamName" placeholder="Teamname" required>
              <label for="teamName">Teamname</label>
            </div>

            <div class="form-floating mb-3">
              <textarea class="form-control" id="teamInfo" style="height: 90px" placeholder="Beschreibung"></textarea>
              <label for="teamInfo">Beschreibung / Sonstiges (optional)</label>
            </div>

            <div class="text-end">
              <button class="btn btn-primary btn-sm" type="submit">
                <i class="bi bi-save me-1"></i> Team speichern
              </button>
            </div>
          </form>

          <div class="bg-white border rounded p-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="fw-semibold">Vorhandene Teams</div>
              <span class="text-muted small">Bearbeiten / Löschen</span>
            </div>
            <ul class="list-group list-group-sm" id="teamList"></ul>
          </div>

        </div>
      </div>
    </div>

    <!-- ARBEITSBEREICHE -->
    <div class="accordion-item border-0 mb-3 shadow-sm">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed bg-white text-dark fw-semibold"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#bereichBlock">
          <i class="bi bi-briefcase me-2"></i> Arbeitsbereiche
        </button>
      </h2>

      <div id="bereichBlock" class="accordion-collapse collapse" data-bs-parent="#orgAccordion">
        <div class="accordion-body bg-light">

          <form id="bereichForm" class="mb-4">
            <div class="form-floating mb-3">
              <input class="form-control" id="bereichName" placeholder="Bezeichnung" required>
              <label for="bereichName">Bezeichnung</label>
            </div>

            <div class="form-floating mb-3">
              <textarea class="form-control" id="bereichText" style="height: 110px" placeholder="Standardtext"></textarea>
              <label for="bereichText">Standardtext für Berichte (optional)</label>
            </div>

            <div class="text-end">
              <button class="btn btn-primary btn-sm" type="submit">
                <i class="bi bi-save me-1"></i> Arbeitsbereich speichern
              </button>
            </div>
          </form>

          <div class="bg-white border rounded p-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="fw-semibold">Vorhandene Arbeitsbereiche</div>
              <span class="text-muted small">Bearbeiten / Löschen</span>
            </div>
            <ul class="list-group list-group-sm" id="bereichList"></ul>
          </div>

        </div>
      </div>
    </div>

  </div>
</div>

<!-- Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Demo-Logik: LocalStorage + Bearbeiten -->
<script>
function escHtml(str) {
  return String(str ?? "")
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;")
    .replaceAll("'", "&#039;");
}

function setupEditableList({
  formId,
  fields,          // [{id, label}]
  listId,
  storageKey,
  formatPreview    // (obj) => string
}) {
  const form = document.getElementById(formId);
  const list = document.getElementById(listId);

  function load() {
    return JSON.parse(localStorage.getItem(storageKey) || "[]");
  }
  function save(data) {
    localStorage.setItem(storageKey, JSON.stringify(data));
  }

  function render() {
    const data = load();
    list.innerHTML = "";

    if (data.length === 0) {
      const empty = document.createElement("div");
      empty.className = "text-muted small";
      empty.textContent = "Noch keine Einträge vorhanden.";
      list.appendChild(empty);
      return;
    }

    data.forEach((item, idx) => {
      const li = document.createElement("li");
      li.className = "list-group-item";

      const preview = formatPreview(item);

      li.innerHTML = `
        <div class="d-flex justify-content-between align-items-start gap-3">
          <div class="flex-grow-1">
            <div class="fw-semibold">${escHtml(preview)}</div>
          </div>

          <div class="btn-group btn-group-sm flex-shrink-0">
            <button class="btn btn-outline-secondary" data-action="edit">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-outline-danger" data-action="delete">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </div>

        <div class="mt-3 d-none" data-edit-panel>
          <div class="row g-2">
            ${fields.map(f => `
              <div class="col-md-6">
                <div class="form-floating">
                  <input class="form-control" placeholder="${escHtml(f.label)}" data-field="${escHtml(f.id)}" value="${escHtml(item[f.id] || "")}">
                  <label>${escHtml(f.label)}</label>
                </div>
              </div>
            `).join("")}
          </div>

          <div class="d-flex justify-content-end gap-2 mt-2">
            <button class="btn btn-outline-secondary btn-sm" data-action="cancel">
              Abbrechen
            </button>
            <button class="btn btn-primary btn-sm" data-action="save">
              <i class="bi bi-save me-1"></i> Speichern
            </button>
          </div>
        </div>
      `;

      li.querySelector('[data-action="delete"]').addEventListener("click", () => {
        const next = load().filter((_, i) => i !== idx);
        save(next);
        render();
      });

      li.querySelector('[data-action="edit"]').addEventListener("click", () => {
        li.querySelector("[data-edit-panel]").classList.toggle("d-none");
      });

      li.querySelector('[data-action="cancel"]').addEventListener("click", () => {
        li.querySelector("[data-edit-panel]").classList.add("d-none");
        render(); // reset values
      });

      li.querySelector('[data-action="save"]').addEventListener("click", () => {
        const next = load();
        const panel = li.querySelector("[data-edit-panel]");
        const updated = { ...next[idx] };

        panel.querySelectorAll("[data-field]").forEach(inp => {
          const key = inp.getAttribute("data-field");
          updated[key] = inp.value.trim();
        });

        // simple Pflichtfeld-Check: erstes Feld
        const firstKey = fields[0].id;
        if (!updated[firstKey]) return;

        next[idx] = updated;
        save(next);
        render();
      });

      list.appendChild(li);
    });
  }

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const obj = {};
    fields.forEach(f => {
      obj[f.id] = (document.getElementById(f.id).value || "").trim();
    });

    // Pflichtfeld: erstes Feld
    if (!obj[fields[0].id]) return;

    const data = load();
    data.push(obj);
    save(data);
    form.reset();
    render();
  });

  render();
}

/* Jobcenter */
setupEditableList({
  formId: "jobcenterForm",
  listId: "jobcenterList",
  storageKey: "org_jobcenter",
  fields: [
    { id: "jcName", label: "Name des Jobcenters" },
    { id: "jcZusatz", label: "Firmenname-Zusatz (optional)" }
  ],
  formatPreview: (o) => o.jcZusatz ? `${o.jcName} (${o.jcZusatz})` : o.jcName
});

/* Teams */
setupEditableList({
  formId: "teamForm",
  listId: "teamList",
  storageKey: "org_teams",
  fields: [
    { id: "teamName", label: "Teamname" },
    { id: "teamInfo", label: "Beschreibung / Sonstiges (optional)" }
  ],
  formatPreview: (o) => o.teamInfo ? `${o.teamName} – ${o.teamInfo}` : o.teamName
});

/* Arbeitsbereiche */
setupEditableList({
  formId: "bereichForm",
  listId: "bereichList",
  storageKey: "org_bereiche",
  fields: [
    { id: "bereichName", label: "Bezeichnung" },
    { id: "bereichText", label: "Standardtext für Berichte (optional)" }
  ],
  formatPreview: (o) => o.bereichText ? `${o.bereichName} – ${o.bereichText}` : o.bereichName
});
</script>

</body>
</html>
